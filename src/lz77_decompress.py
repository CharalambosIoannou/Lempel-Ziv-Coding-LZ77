import math
import time
import bitarray

def get_tuples(inp,lookahead_buffer_size , window_size):
    string_decode=[]
    d_bits=math.ceil(math.log(window_size+1,2))
    l_bits=math.ceil(math.log(lookahead_buffer_size+1,2))
    char_bits=8
    total_bits_needed= d_bits+l_bits+char_bits
    n=total_bits_needed
    for i in range (0, len(inp), n):
        tuples=inp[i:i+n]
        get_d_binary=tuples[0:d_bits]
        get_l_binary=tuples[d_bits:l_bits+d_bits]
        get_letter_binary=tuples[-8:]
        d_denary=int(get_d_binary,2)
        l_denary=int(get_l_binary,2)
        letter_denary=int(get_letter_binary,2)
        string_decode.append([d_denary,l_denary,letter_denary])
    #print(string_decode)
    return string_decode


def decompress(string_decode,lookahead_buffer_size , window_size):
    final_string=""
    for tuples in string_decode:
        #print(tuples)
        if (tuples[0] == 0):
            final_string=final_string+chr(tuples[2])
        else:
            start_repeating=len(final_string)-tuples[0]
            end_repeating=len(final_string)-tuples[0]+tuples[1]            
            repeated_string=final_string[start_repeating:end_repeating]
            next_letter=chr(tuples[2])
            final_string=final_string+repeated_string+next_letter
    return final_string
            


lookahead_buffer_size=255
window_size=65535
inp="000000000000000000000000011010010000000000000000000000000111010000000000000000000000000000100000000000000000000000000000011101110000000000000000000000000110000100000000000000000000000001110011000000000000010000000001011000010000000000000010000000010110001000000000000000000000000001110010000000000000101100000001011001110000000000000000000000000110100000000000000011010000001001100011000000000000000000000000011011110000000000000000000000000110110000000000000000000000000001100100000000000000010100000001011001000000000000001111000000010111100100000000000001000000000101101001000000000000000000000000011011100000000000000011000000010100000100000000000000000000000001110000000000000001010000000010011011000000000000000000000000000010110000000000000111000000001001101110000000000001001000000010011101000000000000011011000000010110010100000000000110110000001001101100000000000001110000000001011000110000000000000000000000000110101100000000001010110000001001110111000000000000101000000001011100100000000000001100000000100111001100000000000100010000000101110010000000000001101100000001011010110000000000100011000000100110011100000000000110010000001101101001000000000000101000000001011101000000000000010000000000010110010100000000000010100000000100101110000000000000101000000001010101110000000000001111000000100111001100000000000010100000000101101111000000000011011000000010010100110000000000000000000000000110110100000000010101000000001001101000000000000011011000000010011010000000000000000110000000010111001100000000001100100000001001101000000000000100011000000011011011100000000000000000000000000111010100000000000000000000000001111010000000000000000100000001011011000000000000100001000000010110010000000000010100010000001101110100000000000001111000000001001000000000000000010110000001000110001000000000010000000000001001100001000000000010101000000010001000000000000000011011000000110110000100000000000000110000001001100101000000000000000000000000011001100000000000000001000000010110111100000000010000010000001000100000000000000001101100000011011001010000000000010100000000010110001100000000000100000000000101110000000000000101101000000010011101000000000001101010000000110111011000000000011101110000001001100101000000000110100000000010011010010000000001111000000000100010110000000000011010010000001001101100000000000000011100000001011100000000000000010110000000100110010000000000000010000000000101110001000000000100011000000001011010010000000001111101000000100110110000000000100101110000001001110100000000000001111100000001011100100000000000101011000000010111010100000000101010010000001000100000000000000010011100000100011001110000000000010000000000010110000100000000000111110000000101110011000000001010110100000010011011110000000001000001000000100111001100000000000001100000000101101111000000000100011100000001001000000000000000000000000000000101011000000000001000100000001001110100000000000000101100000010011110010000000000001000000000010100110100000000010101110000001001110011000000000000101100000001011011110000000000000100000000100010110000000000001001010000001101101111000000000010110000000100011011100000000000000110000000010111010000000000010000000000100101100101000000000000110100000010011101010000000000111111000001000110111100000000000000110000000101110000000000001000011100000010011101100000000000001110000000100111010000000000111110110000001101110011000000000110101100000010011100100000000000011011000000010010000000000000010000100000001101100111000000001101010100000010011101000000000000000001000000010111100100000000010100100000001001110101000000001001111100000011011001100000000001101000000000100110110100000000001011100000001101110100000000001110111000000010001011010000000010101011000000110110011100000000001001110000001001101100000000000101001100000010011001110000000010010101000000110111010000000000001111010000001001101000000000000000010100000001011011010000000011101111000000100000110100000000000000000000000000001010"
start= time.time()
a=get_tuples(inp,lookahead_buffer_size , window_size)   
b=decompress(a,lookahead_buffer_size , window_size)

final=time.time()
print("Total time: ", final - start)
print(b)
